<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/icon.ico">
    <div class="title-container">
        <h1 class="text-3xl font-bold mb-8">Dev Hub</h1>
    </div>
    <title>Dev Hub</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <style>
        /* Common styles for Dark and Light Mode */
        body {
            font-family: SF Pro Medium, 'Ubuntu', Roboto, Oxygen, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f0f0f0;
            color: #333;
            transition: all 0.3s ease;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 2rem;
        }

        .sidebar {
            width: 200px;
            margin-right: 2rem;
            flex-shrink: 0;
            background-color: #f0f0f0;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            user-select: none;
        }

        .content {
            flex-grow: 1;
        }

        /* CSS für das Zentrieren der Überschrift und Hinzufügen von Platz unten */
        .sidebar h2 {
            text-align: center; /* Überschrift zentrieren */
            margin-top: 15px; /* Platz unten hinzufügen */
        }

        /* CSS für das Zentrieren der Navigationsfelder in der Sidebar */
        .sidebar ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center; /* Horizontal zentrieren */
            margin: 10px;
        }

        /* CSS für die Animation des Rahmens um Navigationselemente */
        .sidebar a {
            display: block;
            padding: 0.5rem 0;
            color: #555;
            text-decoration: none;
            position: relative;
            transition: color 0.3s ease;
        }
        
        .sidebar a:hover {
            color: #007bff;
        }
        
        .sidebar a::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 2px;
            background-color: #007bff;
            transition: width 0.3s ease;
        }
        
        .sidebar a:hover::before {
            width: 100%;
        }

        .create-post-form textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            color: #333;
            resize: vertical;
        }

    /* Neumorphism styles for the posts */
    .post {
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        padding: 1rem;
        margin-bottom: 1rem;
        color: #333;
        border-radius: 16px;
        box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5);
        transition: transform 0.3s ease, box-shadow 0.3s ease; /* Hinzugefügt für Hover-Effekt */
    }

    .post:hover {
        transform: scale(1.05); /* Vergrößern des Posts beim Hover */
        box-shadow: 0 0 16px rgba(0, 0, 0, 0.1); /* Schatteneffekt beim Hover */
    }

    /* Neumorphism styles for dark mode */
    body.dark-mode .post {
        background-color: #222;
        border: 1px solid #333;
        color: #eee;
        box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
    }

    body.dark-mode .post:hover {
        box-shadow: 0 0 16px rgba(0, 0, 0, 0.5); /* Schatteneffekt beim Hover */
    }

        .post h3 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .post p {
            margin-bottom: 0.5rem;
            color: #555;
        }

        /* CSS styles for the date */
        .post .date {
            font-size: 0.8rem;
            color: #555;
        }

        /* Neumorphism styles for Dark Mode */
        body.dark-mode {
            background-color: #222;
            color: #eee;
        }

        body.dark-mode .sidebar {
            background-color: #222;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .sidebar a {
            color: #aaa;
        }

        body.dark-mode .create-post-form textarea {
            background-color: #222;
            color: #eee;
        }

        body.dark-mode .post {
            background-color: #222;
            border: 1px solid #333;
            color: #eee;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .post h3 {
            color: #eee;
        }

        body.dark-mode .post p {
            color: #aaa;
        }

        body.dark-mode .post .date {
            color: #aaa;
        }

        /* Neumorphism styles for title and content */
        .title-container {
            padding: 1rem;
            background-color: #f0f0f0;
            color: #333;
            border-radius: 16px;
            margin-bottom: 20px;
            text-align: center;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .content-container {
            padding: 1rem;
            background-color: #f0f0f0;
            color: #333;
            border-radius: 16px;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        body.dark-mode .title-container {
            padding: 1rem;
            background-color: #222;
            color: #eee;
            margin-bottom: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        body.dark-mode .content-container {
            padding: 1rem;
            background-color: #222;
            color: #eee;
            border-radius: 16px;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
            
        }

        /* Neumorphism styles for the Send button */
        #postForm button {
            background-color: #007bff;
            color: #fff;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease; /* Hinzugefügt für Übergangseffekte */
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5); /* Neumorphism-Effekt */
        }
    
        #postForm button:hover {
            background-color: #0056b3;
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.3); /* verstärkter Schatten beim Hover */
        }
    
        /* Neumorphism styles for dark mode */
        body.dark-mode #postForm button {
            background-color: #007bff;
            color: #eee;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }
    
        body.dark-mode #postForm button:hover {
            background-color: #0056b3;
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.5); /* verstärkter Schatten beim Hover */
        }
        
        /* Dark Mode styles for the button */
        body.dark-mode .create-post-form button {
            background-color: #222;
            color: #eee;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }
        
        body.dark-mode .create-post-form button:hover {
            background-color: #333;
        }

        ::-webkit-scrollbar {
            width: 8px; /* Breite der Scrollleiste */
            transition: width 0.3s ease; /* Übergangseffekt für die Breite */
        }

        ::-webkit-scrollbar-track {
            background: transparent; /* Hintergrundfarbe der Scrollleiste */
        }

        /* Bei Hover die Scrollleistenbreite ändern */
        ::-webkit-scrollbar:hover {
            width: 14px; /* Breite der Scrollleiste bei Hover */
            cursor: pointer;
        }

        ::-webkit-scrollbar-thumb {
            background: #888; /* Farbe des Scrollleisten-Griffs */
            border-radius: 10px; /* Radius der Scrollleisten-Griffkanten */
        }

        /* Neumorphismus-Stil für den Dark/White Mode Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Stil für den Text des Dark/White Mode Switch */
        .switch-label {
            margin-left: 0.5rem;
            font-size: 0.875rem;
            color: #333; /* Farbe des Textes */
        }

        /* Dark Mode-Stil für den Text des Dark/White Mode Switch */
        body.dark-mode .switch-label {
            color: #eee; /* Farbe des Textes im Dark Mode */
        }

    </style>
</head>
<body class="dark-mode"> <!-- Standardmäßig Dark-Mode aktiviert -->

    <div class="container mx-auto">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2 class="text-lg font-semibold mb-4">Welcome, <span id="username"></span>!</h2>
            <h2></h2>
            <ul>
                <li><a href="/settings">Settings</a></li>
                <li><a href="/profile">Profile</a></li>
                <li id="loginLink"><a href="/login">Login</a></li>
                <li id="signupLink"><a href="/signup">Sign-Up</a></li>
                <li id="signoutLink"><a href="#" id="signoutBtn">Sign Out</a></li>
                <li><a href="/intro">DEV: Intro</a></li>
                <li><a href="/admin">DEV: Admin</a></li>
            </ul>
        </div>

<!-- Content -->
<div class="content-container">
    <form id="postForm" class="mb-8">
        <div class="mb-4">
            <label for="postDescription" class="block text-sm font-medium text-gray-400">Description</label>
            <textarea id="postDescription" name="postDescription" rows="1" cols="50" maxlength="500" placeholder="Describe your code!" class="mt-1 px-3 py-2 block w-full border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500 bg-gray-800 text-white" style="resize: none;"></textarea>
        </div>
        <div class="mb-4">
            <label for="postContent" class="block text-sm font-medium text-gray-400">Code Snippet</label>
            <textarea id="postContent" name="postContent" rows="3" cols="50" maxlength="3000" placeholder="Paste your code in!" class="mt-1 px-3 py-2 block w-full border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500 bg-gray-800 text-white" style="resize: none; max-width: 100%;"></textarea>
        </div>                                                 
        <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">Send</button>
    </form>

    <!-- Latest posts section -->
    <div id="latestPosts"></div>
</div>
<script> 
    async function showWelcomeMessage() {
        try {
            const savedUser = localStorage.getItem('user'); // Benutzerdaten aus dem Speicher abrufen
            if (savedUser) {
                const { identifier } = JSON.parse(savedUser);
                document.getElementById('username').textContent = identifier;
            } else {
                // Benutzer ist nicht authentifiziert, leite ihn auf die Login-Seite weiter
                window.location.href = '/login';
            }
        } catch (error) {
            console.error('Error fetching user data:', error);
        }
    }

    async function createPost(event) {
    event.preventDefault(); // Verhindert das Standardformularverhalten

    const postContent = document.getElementById('postContent').value;
    const postDescription = document.getElementById('postDescription').value;

    // Überprüfen, ob der Beitragsinhalt leer ist
    if (!postContent.trim()) {
        return;
    }

    try {
        const savedUser = localStorage.getItem('user'); // Benutzerdaten aus dem Speicher abrufen
            if (savedUser) {
                const { identifier: identifier } = JSON.parse(savedUser); // Benutzername extrahieren

            // Überprüfen, ob der Benutzer den Cooldown erreicht hat
            const lastPostTime = localStorage.getItem('lastPostTime');
            const postCount = parseInt(localStorage.getItem('postCount')) || 0;
            const currentTime = Date.now();
            const cooldownDuration = postCount >= 10 ? 5000 : 15000; // 1 Minute Cooldown, wenn mehr als 10 Posts, sonst 15 Sekunden

            if (!lastPostTime || currentTime - parseInt(lastPostTime) >= cooldownDuration) {
                // Benutzer hat den Cooldown erreicht oder ist neu, Beitrag kann gesendet werden
                const response = await fetch('/api/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ codesnippet: postContent, identifier: identifier, content: postDescription }) // Benutzername zum Beitrag hinzufügen
                });
                const data = await response.json();
                document.getElementById('postContent').value = '';
                document.getElementById('postDescription').value = '';
                await getPosts();

                // Cooldown zurücksetzen und aktualisieren
                localStorage.setItem('lastPostTime', currentTime);
                localStorage.setItem('postCount', postCount >= 10 ? 10 : postCount + 1);

                // Code-Snippet im localStorage speichern
                localStorage.setItem('lastPostedCode', postContent);
            } else {
                // Benutzer hat den Cooldown nicht erreicht, Anzeige einer Toast-Nachricht
                Toastify({
                    text: `You've posted too frequently. Please wait before posting again.`,
                    style: {
                        background: 'linear-gradient(to right, #ff416c, #ff4b2b)',
                    },
                    className: 'rounded', // Abgerundete Ecken hinzufügen
                    duration: 3000
                }).showToast();
            }
        } else {
            // Benutzerdaten sind nicht im lokalen Speicher gespeichert
            window.location.href = '/login';
        }
    } catch (error) {
        console.error('Error creating post:', error);
    }
}

async function getPosts() {
    try {

        // Rufen Sie die Posts ab
        const response = await fetch('/api/posts');
        const posts = await response.json();

        // Verarbeiten und Anzeigen der Posts
        const postsContainer = document.getElementById('latestPosts');
        postsContainer.innerHTML = ''; // Leeren des Container-Inhalts

        posts.forEach(post => {
            const postElement = document.createElement('div');
            postElement.classList.add('post', 'p-4', 'rounded', 'shadow', 'mb-4');

            const username = post.username;

            // Benutzername hinzufügen
            const usernameElement = document.createElement('h3');
            usernameElement.textContent = `@${username}`;

            const contentElement = document.createElement('p');
            contentElement.textContent = post.content;

            // Code-Snippet hinzufügen
            const codeSnippetElement = document.createElement('pre');
            codeSnippetElement.textContent = post.codesnippet;
            codeSnippetElement.classList.add('bg-gray-800', 'text-white', 'p-4', 'rounded');
            codeSnippetElement.style.whiteSpace = 'pre-wrap'; // Text in Zeilen umbrechen
            codeSnippetElement.style.maxWidth = '100%'; // Maximalbreite setzen

            const dateElement = document.createElement('p');
            dateElement.textContent = post.date;

            postElement.appendChild(usernameElement);
            postElement.appendChild(dateElement);
            postElement.appendChild(contentElement);
            postElement.appendChild(codeSnippetElement);

            postsContainer.appendChild(postElement); // Füge den Post zum Container hinzu
        });
    } catch (error) {
        console.error('Error fetching posts:', error);
    }
}

    // Funktion zum Abmelden des Benutzers
    document.getElementById('signoutBtn').addEventListener('click', () => {
        localStorage.removeItem('user'); // Benutzerdaten aus dem lokalen Speicher entfernen
        localStorage.removeItem('mode'); // Dark / White Mode entfernen
        window.location.href = '/login'; // Auf die Login-Seite weiterleiten
    });

    document.getElementById('postForm').addEventListener('submit', createPost);

    getPosts();
    showWelcomeMessage();
    applyHoverEffectToPosts();

    function addHoverEffect(post) {
        post.addEventListener("mouseenter", function() {
            this.style.transform = "scale(1.05)";
            this.style.boxShadow = "0 0 16px rgba(0, 0, 0, 0.1)";
        });
        post.addEventListener("mouseleave", function() {
            this.style.transform = "scale(1)";
            this.style.boxShadow = "4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5)";
        });
    }

    function formatCode(text) {
    return text.replace(/\n/g);
}

// Beispielaufruf
var postContent = document.getElementById('postContent').value;
var formattedPostContent = formatCode(postContent);


    // Funktion zum Anwenden des Hover-Effekts auf alle Posts
    function applyHoverEffectToPosts() {
        const posts = document.querySelectorAll(".post");
        posts.forEach(post => {
            addHoverEffect(post); // Füge den Hover-Effekt zu jedem Post hinzu
        });
    }

    function loadModePreference() {
    // Lade den gespeicherten Moduswert aus dem Local Storage
    const mode = localStorage.getItem('mode');
    if (mode === 'dark') {
        // Wenn der Modus dunkel ist, füge die entsprechende Klasse hinzu
        document.body.classList.remove('light-mode');
        document.body.classList.add('dark-mode');
    } else {
        // Andernfalls füge die Klasse für den hellen Modus hinzu
        document.body.classList.remove('dark-mode');
        document.body.classList.add('light-mode');
    }
    console.log('Y');
    console.log('YO');
    console.log('YOO');
    console.log('YOOO');
    console.log('YOOO.');
    console.log('YOOO. ');
    console.log('YOOO. I');
    console.log('YOOO. I.');
    console.log('YOOO. I. ');
    console.log('YOOO. I. S');
    console.log('YOOO. I. SE');
    console.log('YOOO. I. SEE');
    console.log('YOOO. I. SEE.');
    console.log('YOOO. I. SEE. ');
    console.log('YOOO. I. SEE. Y');
    console.log('YOOO. I. SEE. YO');
    console.log('YOOO. I. SEE. YOU');
    console.log('YOOO. I. SEE. YOU.');
    console.log('YOOO. I. SEE. YOU.');
    console.log('YOOO. I. SEE. YOU');
    console.log('YOOO. I. SEE. YO');
    console.log('YOOO. I. SEE. Y')
    console.log('YOOO. I. SEE. ');
    console.log('YOOO. I. SEE.');
    console.log('YOOO. I. SEE');
    console.log('YOOO. I. SE');
    console.log('YOOO. I. S');
    console.log('YOOO. I. ');
    console.log('YOOO. I.');
    console.log('YOOO. I');
    console.log('YOOO. ');
    console.log('YOOO.');
    console.log('YOOO');
    console.log('YOO');
    console.log('YO');
    console.log('Y');
}

    loadModePreference();

</script>
</body>
</html>