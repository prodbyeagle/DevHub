<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="icon.ico">
    <div class="title-container">
        <h1 class="text-3xl font-bold mb-8">Dev Hub</h1>
    </div>
    <title>Dev Hub</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <style>
        /* Common styles for Dark and Light Mode */
        body {
            font-family: SF Pro Medium, 'Helvetica Neue', sans-serif;
            background-color: #f0f0f0;
            color: #333;
            transition: all 0.3s ease;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 2rem;
        }

        .sidebar {
            width: 200px;
            margin-right: 2rem;
            flex-shrink: 0;
            background-color: #f0f0f0;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            user-select: none;
            position: sticky;
            top: 43px;
        }

        .sidebar:hover {
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.1);
        }

        .content {
            flex-grow: 1;
        }

        /* CSS für das Zentrieren der Überschrift und Hinzufügen von Platz unten */
        .sidebar h2 {
            text-align: center; /* Überschrift zentrieren */
            margin-top: 15px; /* Platz unten hinzufügen */
        }

        /* CSS für das Zentrieren der Navigationsfelder in der Sidebar */
        .sidebar ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center; /* Horizontal zentrieren */
            margin: 10px;
        }

        /* CSS für die Animation des Rahmens um Navigationselemente */
        .sidebar a {
            display: block;
            padding: 0.5rem 0;
            color: #555;
            text-decoration: none;
            position: relative;
            transition: color 0.3s ease;
        }
        
        .sidebar a:hover {
            color: #007bff;
        }
        
        .sidebar a::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 2px;
            background-color: #007bff;
            transition: width 0.3s ease;
        }
        
        .sidebar a:hover::before {
            width: 100%;
        }

        .create-post-form textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            color: #333;
            resize: vertical;
        }

    /* Neumorphism styles for the posts */
    .post {
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        padding: 1rem;
        margin-bottom: 1rem;
        color: #333;
        border-radius: 16px;
        box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5);
        transition: transform 0.3s ease, box-shadow 0.3s ease; /* Hinzugefügt für Hover-Effekt */
    }

    .post:hover {
        transform: scale(1.02); /* Vergrößern des Posts beim Hover */
        box-shadow: 0 0 16px rgba(0, 0, 0, 0.1); /* Schatteneffekt beim Hover */
    }

    /* Neumorphism styles for dark mode */
    body.dark-mode .post {
        background-color: #222;
        border: 1px solid #333;
        color: #eee;
        box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
    }

    body.dark-mode .post:hover {
        box-shadow: 0 0 16px rgba(0, 0, 0, 0.5); /* Schatteneffekt beim Hover */
    }

        .post h3 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .post p {
            margin-bottom: 0.5rem;
            color: #555;
        }

        /* CSS styles for the date */
        .post .date {
            font-size: 0.8rem;
            color: #555;
        }

        /* Neumorphism styles for Dark Mode */
        body.dark-mode {
            background-color: #222;
            color: #eee;
        }

        body.dark-mode .sidebar {
            background-color: #222;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
            position: sticky;
            top: 20px;
            transition: all 0.3s ease;
        }

        body.dark-mode .sidebar a {
            color: #aaa;
        }

        body.dark-mode .sidebar:hover {
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.5);
            transform: scale(1.05);
            transition: all 0.3s ease;
        }

        body.dark-mode .create-post-form textarea {
            background-color: #222;
            color: #eee;
        }

        body.dark-mode .post {
            background-color: #222;
            border: 1px solid #333;
            color: #eee;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .post h3 {
            color: #eee;
        }

        body.dark-mode .post p {
            color: #aaa;
        }

        body.dark-mode .post .date {
            color: #aaa;
        }

        /* Neumorphism styles for title and content */
        .title-container {
            padding: 1rem;
            background-color: #f0f0f0;
            color: #333;
            border-radius: 16px;
            margin-bottom: 20px;
            text-align: center;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .content-container {
            padding: 1rem;
            background-color: #f0f0f0;
            color: #333;
            border-radius: 16px;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        body.dark-mode .title-container {
            padding: 1rem;
            background-color: #222;
            color: #eee;
            margin-bottom: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        body.dark-mode .content-container {
            padding: 1rem;
            background-color: #222;
            color: #eee;
            border-radius: 16px;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
            
        }

        /* Neumorphism styles for the Send button */
        #postForm button {
            background-color: #007bff;
            color: #fff;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease; /* Hinzugefügt für Übergangseffekte */
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5); /* Neumorphism-Effekt */
        }
    
        #postForm button:hover {
            background-color: #0056b3;
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.3); /* verstärkter Schatten beim Hover */
        }
    
        /* Neumorphism styles for dark mode */
        body.dark-mode #postForm button {
            background-color: #007bff;
            color: #eee;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }
    
        body.dark-mode #postForm button:hover {
            background-color: #0056b3;
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.5); /* verstärkter Schatten beim Hover */
        }
        
        /* Dark Mode styles for the button */
        body.dark-mode .create-post-form button {
            background-color: #222;
            color: #eee;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }
        
        body.dark-mode .create-post-form button:hover {
            background-color: #333;
        }

        ::-webkit-scrollbar {
            width: 8px; /* Breite der Scrollleiste */
            transition: width 0.3s ease; /* Übergangseffekt für die Breite */
        }

        ::-webkit-scrollbar-track {
            background: transparent; /* Hintergrundfarbe der Scrollleiste */
        }

        ::-webkit-scrollbar-thumb {
            background: #888; /* Farbe des Scrollleisten-Griffs */
            border-radius: 8px; /* Radius der Scrollleisten-Griffkanten */
        }

        /* Neumorphismus-Stil für den Dark/White Mode Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Stil für den Text des Dark/White Mode Switch */
        .switch-label {
            margin-left: 0.5rem;
            font-size: 0.875rem;
            color: #333; /* Farbe des Textes */
        }

        /* Dark Mode-Stil für den Text des Dark/White Mode Switch */
        body.dark-mode .switch-label {
            color: #eee; /* Farbe des Textes im Dark Mode */
        }

        .scroll-to-top {
            position: fixed;
            bottom: 20px; /* Adjust as needed */
            right: 20px; /* Adjust as needed */
            z-index: 9999;
            display: none; /* Hide by default */
            width: 60px;
            height: 60px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5);
        }

        .scroll-to-top:hover {
            background-color: #0056b3;
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .scroll-to-top {
            background-color: #222;
            color: #eee;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .scroll-to-top:hover {
            background-color: #333;
        }

                /* Neumorphism styles for the input fields */
                .neumorphism-input {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 0.5rem;
            margin-top: 0.5rem;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }

        body.dark-mode .neumorphism-input {
            border-color: #555;
            background-color: #333;
            color: #eee;
        }

        /* Neumorphism styles for the submit button */
        .neumorphism-button {
            background-color: #007bff;
            color: #fff;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5);
        }

        .neumorphism-button:hover {
            background-color: #0056b3;
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .neumorphism-button {
            background-color: #222;
            color: #eee;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .neumorphism-button:hover {
            background-color: #333;
        }
    
        .search-overlay {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    padding: 20px;
    border-radius: 5px;
    z-index: 999;
    display: none; /* Suchoverlay standardmäßig ausgeblendet */
    animation: fadeIn 0.3s ease; /* Fade-In-Animation hinzugefügt */
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.search-container {
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
}

.search-bar {
    display: flex;
    margin-bottom: 1rem;
}

.search-input {
    flex: 1;
    padding: 0.5rem;
    border: 1px solid #ccc;
    border-radius: 8px;
    margin-right: 0.5rem;
}

/* Dark-Mode-Stile für das Textfeld */
body.dark-mode .search-input {
    background-color: #333; /* Hintergrundfarbe im Dark Mode */
    color: #eee; /* Textfarbe im Dark Mode */
    border-color: #555; /* Randfarbe im Dark Mode */
}

.search-button,
.close-button {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.search-button:hover,
.close-button:hover {
    background-color: #0056b3;;
}

.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Hintergrund leicht verdunkeln */
    z-index: 998; /* Unterhalb des Suchoverlays */
    display: none; /* standardmäßig ausgeblendet */
    animation: all 0.3s ease;
}

.search-overlay.active {
    display: block; /* Suchoverlay anzeigen, wenn die Klasse 'active' hinzugefügt wird */
}

.search-overlay {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    padding: 20px;
    border-radius: 5px;
    z-index: 999;
    display: none; /* Suchoverlay standardmäßig ausgeblendet */
    animation: fadeIn 0.3s ease; /* Fade-In-Animation */
}

/* Fade-In-Animation für das Suchoverlay */
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes fadeOut {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
    }
}

.search-container {
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
}

/* Dark-Mode-Stile für den Suchcontainer */
body.dark-mode .search-container {
    background-color: #333; /* Hintergrundfarbe im Dark Mode */
    color: #eee; /* Textfarbe im Dark Mode */
}

.search-overlay.fade-out {
    animation: fadeOut 0.3s ease; /* Fade-Out-Animation */
}

/* Dark-Mode-Stile für das Suchoverlay */
body.dark-mode .search-overlay {
    background: #333; /* Hintergrundfarbe im Dark Mode */
    color: #eee; /* Textfarbe im Dark Mode */
}

/* Dark-Mode-Stile für die Schaltflächen */
body.dark-mode .search-button,
body.dark-mode .close-button {
    background-color: #555; /* Hintergrundfarbe im Dark Mode */
    color: #eee; /* Textfarbe im Dark Mode */
}

/* Dark-Mode-Stile für das Schließ-Symbol */
body.dark-mode .close-button:hover {
    background-color: #ff4444; /* Schaltflächenfarbe im Dark Mode */
}

/* Dark-Mode-Stile für das Schließ-Symbol */
body.dark-mode .search-button:hover {
    background-color: #1ce358; /* Schaltflächenfarbe im Dark Mode */
}

/* Stil für die Suchergebnisse */
.search-results-item {
    padding: 5px; /* Fügen Sie hier nach Bedarf Abstand hinzu */
    transition: color 0.2s ease; /* Übergangseffekt für Farbänderungen */
}

/* Stil für den Hover-Effekt */
.search-results-item:hover {
    color: #007bff; /* Hellere Farbe bei Hover */
}
    </style>
</head>
<body class="dark-mode"> <!-- Standardmäßig Dark-Mode aktiviert -->

    <div class="container mx-auto">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2 class="text-lg font-semibold mb-4">Welcome, <span id="username"></span>!</h2>
            <h2></h2>
            <ul>
                <li><a id="search-btn" class="search-btn">Search User</a></li>
                <li><a href="/explore">Explore</a></li>
                <li><a href="/profile">Profile</a></li>
                <li><a href="/settings">Settings</a></li>
                <li id="loginLink"><a href="/login">Login</a></li>
                <li id="signupLink"><a href="/signup">Sign-Up</a></li>
                <li id="signoutLink"><a href="#" id="signoutBtn">Sign Out</a></li>
                <h2 class="text-lg font-semibold mb-4">Followers</h2>
                <ul id="follower-list">
            </ul>
        </div>

<!-- Content -->
<div class="content-container">
    <form id="postForm" class="mb-8">
        <div class="mb-4">
            <label for="postDescription" class="block text-sm font-medium text-gray-400">Description</label>
            <textarea id="postDescription" name="postDescription" rows="1" cols="50" maxlength="500" placeholder="Describe your code!" class="mt-1 px-3 py-2 block w-full border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500 bg-gray-800 text-white" style="resize: none;"></textarea>
        </div>
        <div class="mb-4">
            <label for="postContent" class="block text-sm font-medium text-gray-400">Code Snippet</label>
            <textarea id="postContent" name="postContent" rows="3" cols="50" maxlength="3000" placeholder="Paste your code in!" class="mt-1 px-3 py-2 block w-full border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500 bg-gray-800 text-white" style="resize: none; max-width: 100%;"></textarea>
        </div>                                                 
        <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">Send</button>
    </form>

    <!-- Latest posts section -->
    <div id="latestPosts"></div>
</div>

<div class="search-overlay" id="searchOverlay">
        <div class="search-bar mb-4 neumorphism-input">
            <input type="text" id="searchInput" placeholder="Search for a username..." class="search-input">
            <button id="searchButton" class="neumorphism-button text-blue-600 search-button">Search</button>
            <button id="closeButton" class="neumorphism-button text-red-600 close-button">Close</button> <!-- Close-Button hinzugefügt -->
        </div>
        <div id="searchResults" class="neumorphism-input"></div>
</div>
<div class="overlay"></div> <!-- Overlay für Hintergrundverdunkelung -->

<button class="scroll-to-top" onclick="scrollToTop()" title="Go to top">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
    </svg>
</button>
<script> 
    document.addEventListener("DOMContentLoaded", function() {
        const username = localStorage.getItem("user");

        if (username) {
            document.getElementById("loginLink").style.display = "none";
            document.getElementById("signupLink").style.display = "none";
            document.getElementById("signoutLink").style.display = "block";
        } else {
            document.getElementById("loginLink").style.display = "block";
            document.getElementById("signupLink").style.display = "block";
            document.getElementById("signoutLink").style.display = "none";
        }
    });

const searchBtn = document.getElementById('search-btn');
const closeButton = document.getElementById('closeButton');
const overlay = document.querySelector('.overlay');
const searchOverlay = document.getElementById('searchOverlay'); // geändert, um das Suchoverlay zu korrekt zu wählen

searchBtn.addEventListener('click', () => {
    // Überprüfen, ob das Suchoverlay angezeigt oder ausgeblendet ist
    if (!searchOverlay.classList.contains('active')) {
        // Wenn ausgeblendet, dann einblenden
        searchOverlay.classList.add('active');
        overlay.style.display = 'block'; // Overlay anzeigen
    } else {
        // Wenn angezeigt, dann ausblenden
        searchOverlay.classList.remove('active');
        overlay.style.display = 'none'; // Overlay ausblenden
    }
});

closeButton.addEventListener('click', () => {
    // Bei Klick auf den Close-Button das Overlay ausblenden
    searchOverlay.classList.remove('active');
    overlay.style.display = 'none'; // Overlay ausblenden
});

async function showWelcomeMessage() {
    try {
        const savedUser = localStorage.getItem('user'); // Benutzerdaten aus dem Speicher abrufen
        if (savedUser) {
            const { identifier } = JSON.parse(savedUser);

            // Überprüfen, ob der Identifier eine E-Mail-Adresse ist
            if (isValidEmail(identifier)) {
                // Wenn ja, die E-Mail-Adresse verwenden, um den Benutzernamen zu finden
                const response = await fetch('/api/username');
                const userData = await response.json();

                // Finde den Benutzer, der die angegebene E-Mail-Adresse hat
                const matchedUser = userData.users.find(user => user.email === identifier);
                
                if (matchedUser) {
                    // Benutzer gefunden, verwende den Benutzernamen für die Begrüßung
                    document.getElementById('username').textContent = matchedUser.username;
                } else {
                    console.error('User with specified email not found');
                }
            } else {
                // Der Identifier ist kein eine E-Mail-Adresse, daher direkt verwenden
                document.getElementById('username').textContent = identifier;
            }
        } else {
            // Benutzer ist nicht authentifiziert, leite ihn auf die Login-Seite weiter
            window.location.href = '/login';
        }
    } catch (error) {
        console.error('Error fetching user data:', error);
    }
}

// Suchfunktion
const searchInput = document.getElementById('searchInput');
const searchButton = document.getElementById('searchButton');

// Event-Listener für das Klicken auf den Suchbutton
searchButton.addEventListener('click', async function() {
    search();
});

// Event-Listener für das Drücken der Enter-Taste im Eingabefeld
searchInput.addEventListener('keypress', async function(e) {
    if (e.key === 'Enter') {
        search();
    }
});

async function search() {
    const username = searchInput.value.trim();

    if (!username) {
        return;
    }

    if (username) {
        const response = await fetch(`/api/profile/${username}`);
        const userData = await response.json();

        if (userData.username) {
            window.location.href = `/u/${username}`; // Weiterleitung zum Benutzerprofil
        } else {
            Toastify({
                text: "User not found",
                duration: 3000,
                close: true
            }).showToast();
        }
    }
}

// Autocomplete-Funktion
async function autocomplete() {
    const searchInput = document.getElementById("searchInput");
    const searchTerm = searchInput.value.trim().toLowerCase();
    const searchResultsDiv = document.getElementById("searchResults");

    if (searchTerm.length === 0) {
    searchResultsDiv.innerHTML = "<div></div>"; // Anzeige der Platzhaltermeldung
    return;
}


    const response = await fetch(`/api/username`); // API-Endpunkt für die Benutzernamen
    if (response.ok) {
        const userData = await response.json();
        const users = userData.users;

        const filteredResults = users.filter(user => user.username.toLowerCase().startsWith(searchTerm)); // Filtere Benutzernamen, die mit dem Suchbegriff beginnen

        if (filteredResults.length > 0) {
            // Erstelle HTML für Suchergebnisse mit Links zu den Benutzerprofilen
            const resultHTML = filteredResults.map((user, index) => {
            const profilePic = user.pb ? `<img src="${user.pb}" alt="Profile Pic" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 5px; float: left;"/>` : ''; // Wenn ein Profilbild vorhanden ist, füge es hinzu
            const marginBottom = index === filteredResults.length - 1 ? '0' : '10px'; // Bestimme den margin-bottom-Wert
            return `<div class="search-results-item" style="margin-bottom: ${marginBottom};">${profilePic}<a href="/u/${user.username}">${user.username}</a></div>`;
        }).join("");
            searchResultsDiv.innerHTML = resultHTML; // Zeige Suchergebnisse an
        } else {
            searchResultsDiv.innerHTML = "<div>❌ No results found</div>"; // Zeige Meldung an, wenn keine Ergebnisse gefunden wurden
        }
    } else {
        console.error('❌ Error fetching search results');
    }
}

// Event-Handler für das searchInput-Element hinzufügen, um das Autocomplete-Verhalten zu aktivieren
document.getElementById("searchInput").addEventListener("input", autocomplete);

// Funktion zur Überprüfung, ob eine Zeichenkette eine gültige E-Mail-Adresse ist
function isValidEmail(email) {
    // Einfache Überprüfung durch eine Reguläre Ausdruck
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

async function createPost(event) {
    event.preventDefault(); // Verhindert das Standardformularverhalten

    const postContent = document.getElementById('postContent').value;
    const postDescription = document.getElementById('postDescription').value;

    // Überprüfen, ob der Beitragsinhalt leer ist
    if (!postContent.trim()) {
        return;
    }

    try {
        const savedUser = localStorage.getItem('user'); // Benutzerdaten aus dem Speicher abrufen
            if (savedUser) {
                const { identifier: identifier } = JSON.parse(savedUser); // Benutzername extrahieren

                const response = await fetch('/api/username');
                const userData = await response.json();

                // Finde den Benutzer, der die angegebene E-Mail-Adresse hat
                const matchedUser = userData.users.find(user => user.email === identifier);

            // Überprüfen, ob der Benutzer den Cooldown erreicht hat
            const lastPostTime = localStorage.getItem('lastPostTime');
            const postCount = parseInt(localStorage.getItem('postCount')) || 0;
            const currentTime = Date.now();
            const cooldownDuration = postCount >= 10 ? 5000 : 15000; // 1 Minute Cooldown, wenn mehr als 10 Posts, sonst 15 Sekunden

            if (!lastPostTime || currentTime - parseInt(lastPostTime) >= cooldownDuration) {
                // Benutzer hat den Cooldown erreicht oder ist neu, Beitrag kann gesendet werden
                const response = await fetch('/api/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        codesnippet: postContent, 
                        identifier: identifier, 
                        content: postDescription, 
                        likes: 0,
                        replies: [] 
                    })
                });
                const data = await response.json();
                document.getElementById('postContent').value = '';
                document.getElementById('postDescription').value = '';
                await getPosts();

                // Cooldown zurücksetzen und aktualisieren
                localStorage.setItem('lastPostTime', currentTime);
                localStorage.setItem('postCount', postCount >= 10 ? 10 : postCount + 1);

                // Code-Snippet im localStorage speichern
                localStorage.setItem('lastPostedCode', postContent);
            } else {
                // Benutzer hat den Cooldown nicht erreicht, Anzeige einer Toast-Nachricht
                Toastify({
                    text: `You've posted too frequently. Please wait before posting again.`,
                    style: {
                        background: 'linear-gradient(to right, #ff416c, #ff4b2b)',
                    },
                    className: 'rounded', // Abgerundete Ecken hinzufügen
                    duration: 3000
                }).showToast();
            }
        } else {
            // Benutzerdaten sind nicht im lokalen Speicher gespeichert
            window.location.href = '/login';
        }
    } catch (error) {
        console.error('Error creating post:', error);
    }
}

async function getPosts() {
    try {
        // Rufen Sie die Posts ab
        const response = await fetch('/api/posts');
        const posts = await response.json();

        // Rufen Sie die Benutzerdaten ab
        const userResponse = await fetch('/api/username');
        const userData = await userResponse.json();
        const usersArray = userData.users; // Extrahieren Sie das Array der Benutzer

        // Verarbeiten und Anzeigen der Posts
        const postsContainer = document.getElementById('latestPosts');
        postsContainer.innerHTML = ''; // Leeren des Container-Inhalts

        posts.forEach(post => {
            const postElement = document.createElement('div');
            postElement.classList.add('post', 'p-4', 'rounded', 'shadow', 'mb-4');

            const username = post.username;

            const dateElement = document.createElement('p');
            dateElement.textContent = post.date;

            // Benutzerdaten finden
            const user = usersArray.find(user => user.username === username);

            // Benutzername und Datum hinzufügen
            const usernameElement = document.createElement('h3');
            if (user && user.pb) {
                const profileImageElement = document.createElement('img');
                profileImageElement.src = user.pb;
                profileImageElement.alt = `user_pic`;
                profileImageElement.classList.add('profile-image');
                profileImageElement.style.width = '25px';
                profileImageElement.style.height = '25px';
                profileImageElement.style.borderRadius = '50%';
                profileImageElement.style.float = 'left';
                profileImageElement.style.marginRight = '5px';
                postElement.appendChild(profileImageElement);
            }
            usernameElement.textContent = ` @${username} (${dateElement.textContent})`;

            const contentElement = document.createElement('p');
            contentElement.textContent = post.content;

            // Code-Snippet hinzufügen
            const codeSnippetElement = document.createElement('pre');
            codeSnippetElement.textContent = post.codesnippet;
            codeSnippetElement.classList.add('bg-gray-800', 'text-white', 'p-4', 'rounded', 'text-xs');
            codeSnippetElement.style.whiteSpace = 'pre-wrap'; // Text in Zeilen umbrechen
            codeSnippetElement.style.maxWidth = '100%'; // Maximalbreite setzen

            // Highlight.js auf das Code-Snippet anwenden
            hljs.highlightElement(codeSnippetElement);

            // Überprüfen, ob der Post Antworten hat, und die Anzahl der Antworten anzeigen
            const repliesElement = document.createElement('p');
            repliesElement.textContent = `Replies: ${post.replies ? post.replies.length : 0}`;
            
            // Erstellen des Elements für die Anzeige der Likes
            const likesElement = document.createElement('p');
            likesElement.textContent = `Likes: ${post.likes ? post.likes : 0}`; // Änderung: 'post.likes' statt 'post.likes.length'
            
            postElement.appendChild(usernameElement);
            postElement.appendChild(contentElement);
            postElement.appendChild(codeSnippetElement);
            postElement.appendChild(likesElement); // Änderung: Likes-Element richtig hinzufügen
            
            postsContainer.appendChild(postElement); // Füge den Post zum Container hinzu

            
        });
    } catch (error) {
        console.error('Error fetching posts:', error);
    }
}

    // Funktion zum Abmelden des Benutzers
    document.getElementById('signoutBtn').addEventListener('click', () => {
        localStorage.removeItem('user'); // Benutzerdaten aus dem lokalen Speicher entfernen
        localStorage.removeItem('mode'); // Dark / White Mode entfernen
        window.location.href = '/login'; // Auf die Login-Seite weiterleiten
    });

    document.getElementById('postForm').addEventListener('submit', createPost);

    getPosts();
    showWelcomeMessage();
    applyHoverEffectToPosts();

    function addHoverEffect(post) {
        post.addEventListener("mouseenter", function() {
            this.style.transform = "scale(1.03)";
            this.style.boxShadow = "0 0 16px rgba(0, 0, 0, 0.1)";
        });
        post.addEventListener("mouseleave", function() {
            this.style.transform = "scale(1)";
            this.style.boxShadow = "4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5)";
        });
    }

    function formatCode(text) {
    return text.replace(/\n/g);
}

// Beispielaufruf
var postContent = document.getElementById('postContent').value;
var formattedPostContent = formatCode(postContent);


    // Funktion zum Anwenden des Hover-Effekts auf alle Posts
    function applyHoverEffectToPosts() {
        const posts = document.querySelectorAll(".post");
        posts.forEach(post => {
            addHoverEffect(post); // Füge den Hover-Effekt zu jedem Post hinzu
        });
    }

    function loadModePreference() {
            // Lade den gespeicherten Moduswert aus dem Local Storage
            const mode = localStorage.getItem('mode');
            if (mode === 'light') {
                // Wenn der Modus dunkel ist, füge die entsprechende Klasse hinzu
                document.body.classList.remove('dark-mode');
                document.body.classList.add('light-mode');
            } else {
                // Andernfalls füge die Klasse für den hellen Modus hinzu
                document.body.classList.remove('light-mode');
                document.body.classList.add('dark-mode');
            }
            console.log('Mode Loaded:', mode);
            
    // console.log('Y');
    // console.log('YO');
    // console.log('YOO');
    // console.log('YOOO');
    // console.log('YOOO.');
    // console.log('YOOO. ');
    // console.log('YOOO. I');
    // console.log('YOOO. I.');
    // console.log('YOOO. I. ');
    // console.log('YOOO. I. S');
    // console.log('YOOO. I. SE');
    // console.log('YOOO. I. SEE');
    // console.log('YOOO. I. SEE.');
    // console.log('YOOO. I. SEE. ');
    // console.log('YOOO. I. SEE. Y');
    // console.log('YOOO. I. SEE. YO');
    // console.log('YOOO. I. SEE. YOU');
    // console.log('YOOO. I. SEE. YOU.');
    // console.log('YOOO. I. SEE. YOU.');
    // console.log('YOOO. I. SEE. YOU');
    // console.log('YOOO. I. SEE. YO');
    // console.log('YOOO. I. SEE. Y')
    // console.log('YOOO. I. SEE. ');
    // console.log('YOOO. I. SEE.');
    // console.log('YOOO. I. SEE');
    // console.log('YOOO. I. SE');
    // console.log('YOOO. I. S');
    // console.log('YOOO. I. ');
    // console.log('YOOO. I.');
    // console.log('YOOO. I');
    // console.log('YOOO. ');
    // console.log('YOOO.');
    // console.log('YOOO');
    // console.log('YOO');
    // console.log('YO');
    // console.log('Y');
}

    loadModePreference();

        // Function to scroll to the top of the page with animation
        function scrollToTop() {
            const c = document.documentElement.scrollTop || document.body.scrollTop;
            if (c > 0) {
                window.requestAnimationFrame(scrollToTop);
                window.scrollTo(0, c - c / 8);
            }
        }

    window.onscroll = function() {
        scrollFunction();
    };
    
    function scrollFunction() {
        const scrollToTopButton = document.querySelector('.scroll-to-top');
        const scrollPosition = document.documentElement.scrollTop || document.body.scrollTop;
        
        // Adjust the threshold value (50) to your desired scroll position before showing the button
        if (scrollPosition > 1200) {
            scrollToTopButton.style.display = "block";
        } else {
            scrollToTopButton.style.display = "none";
        }
    }

    // Following list on Sidebar

    async function fetchUserData(username) {
    try {
        const response = await fetch(`/api/profile/${username}`);
        const userData = await response.json();
        return userData;
    } catch (error) {
        throw new Error('Fehler beim Abrufen der Benutzerdaten.');
    }
}

async function fetchFollowers(username) {
    try {
        const response = await fetch(`/api/profile/${username}`);
        const userData = await response.json();
        const followers = userData.followers || [];
        return followers;
    } catch (error) {
        throw new Error('Fehler beim Abrufen der Follower.');
    }
}

async function displayFollowersWithPictures() {
    const savedUser = localStorage.getItem('user');
    let username = null;

    if (savedUser) {
        const { identifier } = JSON.parse(savedUser);
        username = identifier;
    }

    if (username) {
        try {
            const followers = await fetchFollowers(username);
            const followerList = document.getElementById('follower-list');
            followerList.innerHTML = ''; // Leere die vorherige Liste

            const maxUsers = 5;
            let count = 0;

            for (const follower of followers) {
                if (count >= maxUsers) break;
                
                const userData = await fetchUserData(follower);
                const followerItem = document.createElement('li');

                // Erstelle das Profilbild-Element und füge die Stile hinzu
                const profilePicture = new Image();
                profilePicture.src = userData.pb;
                profilePicture.alt = `${userData.username}'s Profilbild`;
                profilePicture.style.width = '25px';
                profilePicture.style.height = '25px';
                profilePicture.style.borderRadius = '50%';
                profilePicture.style.float = 'left';
                profilePicture.style.marginRight = '5px';
                followerItem.appendChild(profilePicture);

                // Erstelle den Benutzernamen-Text und füge ihn hinzu
                const usernameElement = document.createElement('span');
                usernameElement.textContent = userData.username;
                followerItem.appendChild(usernameElement);

                // Füge den Follower der Liste hinzu
                followerList.appendChild(followerItem);

                count++;
            }

            // Falls es mehr als fünf Benutzer gibt, füge einen "Other" Button hinzu
            if (followers.length > maxUsers) {
                const otherButton = document.createElement('button');
                otherButton.textContent = 'Other';
                otherButton.addEventListener('click', () => {
                    // Funktion, um das Overlay anzuzeigen, wenn auf den "Other" Button geklickt wird
                });
                followerList.appendChild(otherButton);
            }
        } catch (error) {
            console.error('Fehler:', error);
        }
    } else {
        console.error('Benutzername nicht gefunden.');
    }
}

// Rufe die Funktion zum Anzeigen der Follower mit Profilbildern auf
displayFollowersWithPictures();

</script>
</body>
</html>