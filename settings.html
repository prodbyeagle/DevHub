<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/icon.ico">
    <title>Settings</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        body {
            font-family: SF Pro Medium, 'Ubuntu', Roboto, Oxygen, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f0f0f0;
            color: #333;
            transition: all 0.3s ease;
        }

        /* Neumorphism styles for Dark Mode */
        body.dark-mode {
            background-color: #222;
            color: #eee;
            transition: all 0.3s ease;
        }

        /* Neumorphism styles for the form */
        .neumorphism-form {
            background-color: #f0f0f0;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        body.dark-mode .neumorphism-form {
            background-color: #222;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }

        /* Neumorphism styles for the input fields */
        .neumorphism-input {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 0.5rem;
            margin-top: 0.5rem;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }

        body.dark-mode .neumorphism-input {
            border-color: #555;
            background-color: #333;
            color: #eee;
        }

        /* Neumorphism styles for the submit button */
        .neumorphism-button {
            background-color: #007bff;
            color: #fff;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5);
        }

        .neumorphism-button:hover {
            background-color: #0056b3;
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .neumorphism-button {
            background-color: #222;
            color: #eee;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .neumorphism-button:hover {
            background-color: #333;
        }

        /* Dark Mode styles for the checkbox */
        .neumorphism-checkbox {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 1.4em;
            height: 1.4em;
            border: 2px solid #ccc;
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .neumorphism-checkbox:checked {
            background-color: #007bff;
            border-color: #007bff;
        }

        /* Custom styles for the switch label */
        .switch-label {
            margin-left: 0.5rem;
            font-size: 0.875rem;
            color: #333;
        }

        /* Dark Mode styles for the switch label */
        body.dark-mode .switch-label {
            color: #eee;
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container mx-auto py-8">
        <div class="neumorphism-form max-w-md mx-auto">
            <h1 class="text-3xl font-bold text-center mb-8">Dev Hub: Settings</h1>
            <div class="p-4">
                <label class="block text-sm font-bold mb-2" for="username">
                    Username
                </label>
                <p class="text-lg" id="username"></p> <!-- Hier wird der Benutzername angezeigt -->
            </div>
            <div class="p-4 border-t border-gray-200">
                <label class="block text-sm font-bold mb-2" for="email">
                    Email
                </label>
                <!-- Passwort anzeigen, aber unkenntlich machen -->
                <div class="flex items-center">
                    <p class="text-lg" id="email">******</p>
                    <div class="ml-auto">
                        <!-- SVG-Symbol für das Auge zum Anzeigen/Verbergen des Passworts -->
                        <svg id="toggleEmailVisibility" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2 12s3-6 10-6 10 6 10 6-3 6-10 6-10-6-10-6z" />
                        </svg>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200">
                <label class="block text-sm font-bold mb-2" for="password">
                    Password
                </label>
                <div class="flex items-center">
                    <p class="text-lg" id="password">******</p>
                    <div class="ml-auto">
                        <svg id="togglePasswordVisibility" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2 12s3-6 10-6 10 6 10 6-3 6-10 6-10-6-10-6z" />
                        </svg>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200">
                <h2 class="block text-sm font-bold mb-2">Change Password</h2>
                <form id="changePasswordForm">
                    <div class="mb-4">
                        <div class="p-4 border-t border-gray-200"></div>
                        <label class="block text-sm font-bold mb-2" for="currentPassword">
                            Current Password
                        </label>
                        <input type="password" id="currentPassword" name="currentPassword" class="neumorphism-input" autocomplete>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-bold mb-2" for="newPassword">
                            New Password
                        </label>
                        <input type="password" id="newPassword" name="newPassword" class="neumorphism-input" autocomplete>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-bold mb-2" for="confirmPassword">
                            Confirm New Password
                        </label>
                        <input type="password" id="confirmPassword" name="confirmPassword" class="neumorphism-input" autocomplete>
                    </div>
                    <button type="submit" class="neumorphism-button w-full">Change Password</button>
                </form>
            </div>
        </div>
    </div>

    <div class="flex justify-center items-center fixed inset-x-0 top-120">
        <div class="switch-container mr-4">
            <label class="switch">
                <input id="modeSwitch" type="checkbox" style="display: none;">
                <span class="neumorphism-button h-full text-blue-600">Dark Mode</span>
            </label>
        </div>

        <a href="/home" class="neumorphism-button text-blue-600">Home</a>
    </div>
</body>

<script>
document.addEventListener('DOMContentLoaded', async function() {
    try {
        const savedUser = localStorage.getItem('user');
        if (!savedUser) {
            console.error('User not found in local storage');
            return;
        }
        const { identifier, password, email } = JSON.parse(savedUser);

        const response = await fetch('/api/username');
        const userData = await response.json();

        // Find the user that matches the stored user data
        const matchedUser = userData.users.find(user => (user.username === identifier || user.email === identifier) && user.password === password);

        if (matchedUser) {
            document.getElementById('username').textContent = matchedUser.username;
            document.getElementById('email').textContent = '********************';
            document.getElementById('password').textContent = '********************';
            // Setze das Passwort in einem Attribut, um es später wiederherzustellen
            document.getElementById('password').setAttribute('data-real-password', matchedUser.password);
            document.getElementById('email').setAttribute('data-real-email', matchedUser.email);
        } else {
            console.error('User data does not match stored user');
        }
    } catch (error) {
        console.error('Error fetching user data:', error);
    }
});

// JavaScript für das Anzeigen/Verbergen des Passworts
document.getElementById('togglePasswordVisibility').addEventListener('click', function() {
    const passwordField = document.getElementById('password');
    const realPassword = passwordField.getAttribute('data-real-password');

    // Überprüfe, ob das Passwortfeld bereits sichtbar ist
    if (passwordField.textContent === realPassword) {
        // Ändere den Text auf '******', um das Passwort zu verbergen
        passwordField.textContent = '*****************';
    } else {
        // Zeige das echte Passwort an
        passwordField.textContent = realPassword;
    }
});

// JavaScript für das Anzeigen/Verbergen der E-Mail
document.getElementById('toggleEmailVisibility').addEventListener('click', function() {
    const emailField = document.getElementById('email');
    const realEmail = emailField.getAttribute('data-real-email');

    // Überprüfe, ob das E-Mail-Feld bereits sichtbar ist
    if (emailField.textContent === realEmail) {
        // Ändere den Text auf '******', um das E-Mail zu verbergen
        emailField.textContent = '*****************';
    } else {
        // Zeige die echte E-Mail an
        emailField.textContent = realEmail;
    }
});


    // JavaScript für Dark/White Mode Switch und das Speichern des Moduswerts im Benutzerprofil
    const modeSwitch = document.getElementById('modeSwitch');
    modeSwitch.addEventListener('change', () => {
        if (modeSwitch.checked) {
            document.body.classList.remove('light-mode');
            document.body.classList.add('dark-mode');
            saveModePreference('dark');
        } else {
            document.body.classList.remove('dark-mode');
            document.body.classList.add('light-mode');
            saveModePreference('light');
        }
    });
    
    function saveModePreference(mode) {
        // Hier wird der Moduswert im Benutzerprofil gespeichert
        localStorage.setItem('mode', mode);
    }
    
    function loadModePreference() {
        // Lade den gespeicherten Moduswert aus dem Local Storage
        const mode = localStorage.getItem('mode');
        if (mode === 'dark') {
            // Wenn der Modus dunkel ist, füge die entsprechende Klasse hinzu
            document.body.classList.remove('light-mode');
            document.body.classList.add('dark-mode');
            // Stelle sicher, dass der Switch-Button auf den dunklen Modus eingestellt ist
            modeSwitch.checked = true;
        } else {
            // Andernfalls füge die Klasse für den hellen Modus hinzu
            document.body.classList.remove('dark-mode');
            document.body.classList.add('light-mode');
        }
    }
    
    // Rufe die Funktion zum Laden des Modus beim Laden der Seite auf
    loadModePreference();
    
        // Formular für Passwortänderung
        const changePasswordForm = document.getElementById('changePasswordForm');
        changePasswordForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Verhindert das Standardverhalten des Formulars (z. B. Neuladen der Seite)

            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Hier kannst du weitere Validierungen für die Passwortänderung durchführen

            try {
                // Überprüfen, ob der Benutzer im Local Storage vorhanden ist
                const savedUser = localStorage.getItem('user');
                if (!savedUser) {
                    console.error('User not found in local storage');
                    return;
                }

                // Parse die Benutzerdaten aus dem Local Storage
                const { identifier, password } = JSON.parse(savedUser);

                // Senden der Passwortänderungsanforderung an den Server
                const response = await fetch('/api/username', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: identifier, // Verwende den Benutzernamen aus dem Local Storage
                        currentPassword: currentPassword, // Hier wird das aktuelle Passwort gesendet
                        newPassword: newPassword
                    })
                });

                if (response.ok) {
                    console.log('Password changed successfully');
                    const savedUser = JSON.parse(localStorage.getItem('user'));
                    savedUser.password = newPassword;
                    localStorage.setItem('user', JSON.stringify(savedUser));
                    Toastify({
                        text: 'Password changed successfully',
                        duration: 3000,
                        close: true,
                        backgroundColor: 'linear-gradient(to right, #00b09b, #96c93d)',
                    }).showToast();
                } else {
                    console.error('Failed to change password:', response.statusText);
                    // Hier kannst du eine Fehlermeldung anzeigen
                    Toastify({
                        text: 'Failed to change password: ' + response.statusText,
                        duration: 3000,
                        close: true,
                        backgroundColor: 'linear-gradient(to right, #ff416c, #ff4b2b)',
                    }).showToast();
                }
            } catch (error) {
                console.error('Error changing password:', error);
                // Hier kannst du eine Fehlermeldung anzeigen
                Toastify({
                    text: 'Error changing password: ' + error,
                    duration: 3000,
                    close: true,
                    backgroundColor: 'linear-gradient(to right, #ff416c, #ff4b2b)',
                }).showToast();
            }
        });

</script>
</body>
</body>
</html>